services:
  test_machine:
    image: traefik/whoami
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=frontend"
      - "traefik.http.routers.test_machine.tls.certresolver=myresolver"
      - "traefik.http.routers.test_machine.rule=Host(`$DOMAIN`)"
      - "traefik.http.services.test_machine.loadbalancer.server.port=80"

      - "traefik.http.routers.test_machine.middlewares=custom-header"
      - "traefik.http.middlewares.custom-header.headers.customFrameOptionsValue=ALLOW-FROM https://${DOMAIN}"
      - "traefik.http.middlewares.custom-header.headers.customResponseHeaders.Strict-Transport-Security=15552010"
    networks:
      - frontend

networks:
  frontend:
    external: true


